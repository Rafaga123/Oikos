<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitudes - Gestión de Comunidad</title>
    
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- Semantic UI -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    
    <!-- Font Awesome para más iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Personalizado -->
    <style>
        :root {
            --primary-color: #9A9CEA;
            --success-color: #21ba45;
            --warning-color: #f2711c;
            --danger-color: #db2828;
            --info-color: #2185d0;
        }
        
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        
        .main-content {
            padding: 100px 30px 50px;
            min-height: 100vh;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.pending {
            border-top: 4px solid var(--warning-color);
        }
        
        .stat-card.approved {
            border-top: 4px solid var(--success-color);
        }
        
        .stat-card.rejected {
            border-top: 4px solid var(--danger-color);
        }
        
        .stat-card.total {
            border-top: 4px solid var(--primary-color);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .solicitudes-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .filters-bar {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
        }
        
        .solicitudes-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .solicitud-item {
            padding: 25px;
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.3s;
        }
        
        .solicitud-item:hover {
            background-color: #f8f9fa;
        }
        
        .solicitud-item.pending {
            border-left: 4px solid var(--warning-color);
        }
        
        .solicitud-item.approved {
            border-left: 4px solid var(--success-color);
        }
        
        .solicitud-item.rejected {
            border-left: 4px solid var(--danger-color);
        }
        
        .solicitud-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .solicitud-info {
            flex: 1;
        }
        
        .solicitud-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .solicitud-meta {
            color: #666;
            font-size: 0.9rem;
        }
        
        .solicitud-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending {
            background: #fff3e0;
            color: var(--warning-color);
        }
        
        .status-approved {
            background: #e8f5e9;
            color: var(--success-color);
        }
        
        .status-rejected {
            background: #ffebee;
            color: var(--danger-color);
        }
        
        .solicitud-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-item i {
            color: var(--primary-color);
            width: 20px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
            min-width: 100px;
        }
        
        .detail-value {
            color: #333;
        }
        
        .solicitud-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #bdc3c7;
        }
        
        .modal-content {
            padding: 20px;
        }
        
        .user-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-color);
            margin: 0 auto 20px;
            display: block;
        }
        
        .docs-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .doc-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .doc-item:hover {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        .timeline {
            margin-top: 30px;
            padding-left: 20px;
            border-left: 2px solid #e0e0e0;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 30px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
        }
        
        .timeline-date {
            font-weight: 600;
            color: #555;
        }
        
        .timeline-content {
            color: #666;
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 100px 20px 30px;
            }
            
            .solicitud-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .solicitud-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .filters-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="ui vertical inverted sidebar menu sidebar-menu" style="background-color: #9A9CEA;">
        <div class="item">
            <div class="header">
                <h2 class="ui inverted header">
                    <i class="cog icon"></i>
                    <div class="content">
                        Panel Gestor
                        <div class="sub header">Gestión de Habitantes</div>
                    </div>
                </h2>
            </div>
        </div>
        <div class="item">
            <div class="menu">
                <a class="item" href="dashboard.html">
                    <i class="home icon"></i>
                    Panel de Control
                </a>
                <a class="item" href="gestion_habitantes.html">
                    <i class="users icon"></i>
                    Habitantes
                </a>
                <a class="item" href="crear.html">
                    <i class="plus circle icon"></i>
                    Crear
                </a>
                <a class="item" href="modificar.html">
                    <i class="edit icon"></i>
                    Modificar Reglas
                </a>
                <a class="active item">
                    <i class="clipboard list icon"></i>
                    Solicitudes
                </a>
                <a class="item">
                    <i class="cogs icon"></i>
                    Configuración
                </a>
            </div>
        </div>
        <div class="item">
            <div class="ui divider"></div>
            <a class="item">
                <i class="sign out icon"></i>
                Cerrar Sesión
            </a>
        </div>
        <div class="sidebar-footer-image">
            <img src="../Images/logopng.png" alt="Logo">
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="pusher">
        <!-- Menú Superior -->
        <div class="ui top fixed stackable menu" style="background-color: #9A9CEA;">
            <div class="ui container">
                <a class="item" id="sidebar-toggle">
                    <i class="sidebar icon" style="color: white;"></i>
                </a>
                <div class="header item" style="color: white;">
                    <i class="clipboard list icon"></i>
                    Solicitudes de Ingreso
                </div>
                <div class="right menu">
                    <div class="ui dropdown item" style="color: white;">
                        <i class="user icon" style="color: white;"></i> Gestor
                        <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item"><i class="user icon"></i> Mi Perfil</a>
                            <a class="item"><i class="cog icon"></i> Configuración</a>
                            <div class="divider"></div>
                            <a class="item"><i class="sign out icon"></i> Cerrar Sesión</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="ui container">
                <!-- Header -->
                <div class="ui header">
                    <h1>
                        <i class="clipboard list icon"></i>
                        Solicitudes de Ingreso
                        <div class="sub header">Revisa y gestiona las solicitudes de nuevos habitantes</div>
                    </h1>
                </div>
                
                <div class="ui divider"></div>
                
                <!-- Estadísticas -->
                <div class="dashboard-stats">
                    <div class="stat-card total">
                        <div class="stat-number" id="total-solicitudes">0</div>
                        <div class="stat-label">
                            <i class="clipboard list icon"></i>
                            Total Solicitudes
                        </div>
                    </div>
                    
                    <div class="stat-card pending">
                        <div class="stat-number" id="pending-solicitudes">0</div>
                        <div class="stat-label">
                            <i class="clock icon"></i>
                            Pendientes
                        </div>
                    </div>
                    
                    <div class="stat-card approved">
                        <div class="stat-number" id="approved-solicitudes">0</div>
                        <div class="stat-label">
                            <i class="check circle icon"></i>
                            Aprobadas
                        </div>
                    </div>
                    
                    <div class="stat-card rejected">
                        <div class="stat-number" id="rejected-solicitudes">0</div>
                        <div class="stat-label">
                            <i class="times circle icon"></i>
                            Rechazadas
                        </div>
                    </div>
                </div>
                
                <!-- Contenedor de Solicitudes -->
                <div class="solicitudes-container">
                    <!-- Barra de Filtros -->
                    <div class="filters-bar">
                        <div class="filter-btn active" data-filter="all">
                            <i class="clipboard list icon"></i> Todas
                        </div>
                        <div class="filter-btn" data-filter="pending">
                            <i class="clock icon"></i> Pendientes
                        </div>
                        <div class="filter-btn" data-filter="approved">
                            <i class="check circle icon"></i> Aprobadas
                        </div>
                        <div class="filter-btn" data-filter="rejected">
                            <i class="times circle icon"></i> Rechazadas
                        </div>
                        
                        <div class="ui search search-input">
                            <div class="ui icon input">
                                <input class="prompt" type="text" placeholder="Buscar solicitud...">
                                <i class="search icon"></i>
                            </div>
                            <div class="results"></div>
                        </div>
                        
                        <button class="ui primary button" id="export-btn">
                            <i class="file export icon"></i>
                            Exportar
                        </button>
                    </div>
                    
                    <!-- Lista de Solicitudes -->
                    <div class="solicitudes-list" id="solicitudes-list">
                        <!-- Las solicitudes se cargarán aquí dinámicamente -->
                        <div class="empty-state">
                            <i class="clipboard list icon"></i>
                            <h3>No hay solicitudes pendientes</h3>
                            <p>Todas las solicitudes han sido procesadas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ver Detalles -->
    <div class="ui modal" id="detail-modal">
        <i class="close icon"></i>
        <div class="header" id="modal-header">
            <i class="user icon"></i>
            Detalles de Solicitud
        </div>
        <div class="modal-content" id="modal-content">
            <!-- Contenido dinámico -->
        </div>
        <div class="actions" id="modal-actions">
            <!-- Acciones dinámicas -->
        </div>
    </div>

    <!-- Modal para Aprobar/Rechazar -->
    <div class="ui small modal" id="action-modal">
        <div class="header" id="action-modal-header">Confirmar Acción</div>
        <div class="content" id="action-modal-content">
            <p id="action-message"></p>
            <div class="ui form" id="rejection-form" style="display: none;">
                <div class="field">
                    <label>Motivo del rechazo</label>
                    <textarea id="rejection-reason" rows="3" placeholder="Especifica el motivo del rechazo..."></textarea>
                </div>
            </div>
        </div>
        <div class="actions">
            <div class="ui button cancel-action">Cancelar</div>
            <div class="ui button approve-action" style="display: none;">
                <i class="check icon"></i> Aprobar
            </div>
            <div class="ui red button reject-action" style="display: none;">
                <i class="times icon"></i> Rechazar
            </div>
            <div class="ui primary button confirm-action" style="display: none;">
                <i class="paper plane icon"></i> Confirmar
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        $(document).ready(function() {
            // Inicializar componentes
            $('.ui.dropdown').dropdown();
            $('.ui.search').search({
                source: [],
                searchFields: ['nombre', 'email', 'apartamento'],
                fields: {
                    title: 'nombre',
                    description: 'email'
                },
                onSelect: function(result) {
                    // Implementar búsqueda
                }
            });
            
            // Inicializar modales
            $('#detail-modal').modal();
            $('#action-modal').modal();
            
            // Sidebar toggle
            $('#sidebar-toggle').click(function() {
                $('.ui.sidebar').sidebar('toggle');
            });
            
            // Datos de ejemplo (simulando base de datos)
            let solicitudes = [
                {
                    id: 1,
                    nombre: "María González",
                    email: "maria.gonzalez@email.com",
                    telefono: "+1 234 567 8900",
                    apartamento: "A-402",
                    tipo: "Familiar",
                    fechaSolicitud: "2025-03-15",
                    estado: "pending",
                    documentos: ["identificacion.pdf", "recibo_luz.pdf", "referencias.pdf"],
                    miembros: 3,
                    observaciones: "Familia con dos niños pequeños",
                    foto: "https://randomuser.me/api/portraits/women/32.jpg"
                },
                {
                    id: 2,
                    nombre: "Carlos Rodríguez",
                    email: "carlos.rodriguez@email.com",
                    telefono: "+1 234 567 8901",
                    apartamento: "B-201",
                    tipo: "Individual",
                    fechaSolicitud: "2025-03-14",
                    estado: "approved",
                    documentos: ["identificacion.pdf", "contrato_trabajo.pdf"],
                    miembros: 1,
                    observaciones: "Profesional soltero",
                    foto: "https://randomuser.me/api/portraits/men/42.jpg",
                    fechaAprobacion: "2025-03-16",
                    aprobadoPor: "Admin Principal"
                },
                {
                    id: 3,
                    nombre: "Ana Martínez",
                    email: "ana.martinez@email.com",
                    telefono: "+1 234 567 8902",
                    apartamento: "C-103",
                    tipo: "Familiar",
                    fechaSolicitud: "2025-03-13",
                    estado: "rejected",
                    documentos: ["identificacion.pdf", "recibo_agua.pdf"],
                    miembros: 4,
                    observaciones: "Documentación incompleta",
                    foto: "https://randomuser.me/api/portraits/women/44.jpg",
                    fechaRechazo: "2025-03-15",
                    motivoRechazo: "Falta documentación financiera"
                },
                {
                    id: 4,
                    nombre: "Jorge López",
                    email: "jorge.lopez@email.com",
                    telefono: "+1 234 567 8903",
                    apartamento: "D-305",
                    tipo: "Individual",
                    fechaSolicitud: "2025-03-12",
                    estado: "pending",
                    documentos: ["identificacion.pdf", "estado_cuenta.pdf"],
                    miembros: 1,
                    observaciones: "Estudiante universitario",
                    foto: "https://randomuser.me/api/portraits/men/33.jpg"
                },
                {
                    id: 5,
                    nombre: "Laura Sánchez",
                    email: "laura.sanchez@email.com",
                    telefono: "+1 234 567 8904",
                    apartamento: "A-105",
                    tipo: "Familiar",
                    fechaSolicitud: "2025-03-11",
                    estado: "pending",
                    documentos: ["identificacion.pdf", "referencias.pdf", "recibo_luz.pdf"],
                    miembros: 2,
                    observaciones: "Pareja joven",
                    foto: "https://randomuser.me/api/portraits/women/65.jpg"
                }
            ];
            
            let currentFilter = 'all';
            let currentSolicitudId = null;
            
            // Cargar solicitudes
            function loadSolicitudes() {
                const list = $('#solicitudes-list');
                list.empty();
                
                // Filtrar solicitudes
                let filteredSolicitudes = solicitudes;
                if (currentFilter !== 'all') {
                    filteredSolicitudes = solicitudes.filter(s => s.estado === currentFilter);
                }
                
                // Actualizar estadísticas
                updateStats();
                
                if (filteredSolicitudes.length === 0) {
                    list.html(`
                        <div class="empty-state">
                            <i class="clipboard check icon"></i>
                            <h3>No hay solicitudes</h3>
                            <p>No se encontraron solicitudes con el filtro aplicado</p>
                        </div>
                    `);
                    return;
                }
                
                // Mostrar solicitudes
                filteredSolicitudes.forEach(solicitud => {
                    const estadoTexto = {
                        'pending': 'Pendiente',
                        'approved': 'Aprobada',
                        'rejected': 'Rechazada'
                    }[solicitud.estado];
                    
                    const estadoClass = {
                        'pending': 'status-pending',
                        'approved': 'status-approved',
                        'rejected': 'status-rejected'
                    }[solicitud.estado];
                    
                    const fecha = new Date(solicitud.fechaSolicitud).toLocaleDateString('es-ES', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    
                    const solicitudElement = `
                        <div class="solicitud-item ${solicitud.estado}" data-id="${solicitud.id}">
                            <div class="solicitud-header">
                                <div class="solicitud-info">
                                    <div class="solicitud-name">
                                        ${solicitud.nombre}
                                        <span class="ui tiny label">${solicitud.tipo}</span>
                                    </div>
                                    <div class="solicitud-meta">
                                        <i class="envelope icon"></i> ${solicitud.email} • 
                                        <i class="building icon"></i> ${solicitud.apartamento} • 
                                        <i class="calendar icon"></i> ${fecha}
                                    </div>
                                </div>
                                <div class="solicitud-status ${estadoClass}">
                                    ${estadoTexto}
                                </div>
                            </div>
                            
                            <div class="solicitud-details">
                                <div class="detail-item">
                                    <i class="phone icon"></i>
                                    <span class="detail-label">Teléfono:</span>
                                    <span class="detail-value">${solicitud.telefono}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="users icon"></i>
                                    <span class="detail-label">Miembros:</span>
                                    <span class="detail-value">${solicitud.miembros} persona${solicitud.miembros !== 1 ? 's' : ''}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="file icon"></i>
                                    <span class="detail-label">Documentos:</span>
                                    <span class="detail-value">${solicitud.documentos.length} archivo${solicitud.documentos.length !== 1 ? 's' : ''}</span>
                                </div>
                            </div>
                            
                            <div class="solicitud-actions">
                                <button class="ui primary button view-details" data-id="${solicitud.id}">
                                    <i class="eye icon"></i>
                                    Ver Detalles
                                </button>
                                
                                ${solicitud.estado === 'pending' ? `
                                    <button class="ui green button approve-btn" data-id="${solicitud.id}">
                                        <i class="check icon"></i>
                                        Aprobar
                                    </button>
                                    <button class="ui red button reject-btn" data-id="${solicitud.id}">
                                        <i class="times icon"></i>
                                        Rechazar
                                    </button>
                                ` : ''}
                                
                                ${solicitud.estado === 'approved' ? `
                                    <button class="ui teal button">
                                        <i class="user plus icon"></i>
                                        Crear Cuenta
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    
                    list.append(solicitudElement);
                });
                
                // Agregar eventos
                $('.view-details').click(function() {
                    const id = $(this).data('id');
                    showSolicitudDetails(id);
                });
                
                $('.approve-btn').click(function() {
                    const id = $(this).data('id');
                    confirmAction(id, 'approve');
                });
                
                $('.reject-btn').click(function() {
                    const id = $(this).data('id');
                    confirmAction(id, 'reject');
                });
            }
            
            // Actualizar estadísticas
            function updateStats() {
                $('#total-solicitudes').text(solicitudes.length);
                $('#pending-solicitudes').text(solicitudes.filter(s => s.estado === 'pending').length);
                $('#approved-solicitudes').text(solicitudes.filter(s => s.estado === 'approved').length);
                $('#rejected-solicitudes').text(solicitudes.filter(s => s.estado === 'rejected').length);
            }
            
            // Mostrar detalles de solicitud
            function showSolicitudDetails(id) {
                const solicitud = solicitudes.find(s => s.id === id);
                if (!solicitud) return;
                
                const fecha = new Date(solicitud.fechaSolicitud).toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                $('#modal-header').html(`
                    <i class="user icon"></i>
                    ${solicitud.nombre}
                    <div class="ui horizontal label ${solicitud.estado === 'pending' ? 'yellow' : solicitud.estado === 'approved' ? 'green' : 'red'}">
                        ${solicitud.estado === 'pending' ? 'Pendiente' : solicitud.estado === 'approved' ? 'Aprobada' : 'Rechazada'}
                    </div>
                `);
                
                $('#modal-content').html(`
                    <div class="ui centered grid">
                        <div class="six wide column">
                            <img src="${solicitud.foto}" class="user-photo" alt="${solicitud.nombre}">
                        </div>
                        <div class="ten wide column">
                            <div class="ui list">
                                <div class="item">
                                    <i class="user icon"></i>
                                    <div class="content">
                                        <div class="header">Nombre completo</div>
                                        <div class="description">${solicitud.nombre}</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="envelope icon"></i>
                                    <div class="content">
                                        <div class="header">Email</div>
                                        <div class="description">${solicitud.email}</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="phone icon"></i>
                                    <div class="content">
                                        <div class="header">Teléfono</div>
                                        <div class="description">${solicitud.telefono}</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="building icon"></i>
                                    <div class="content">
                                        <div class="header">Apartamento solicitado</div>
                                        <div class="description">${solicitud.apartamento}</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="users icon"></i>
                                    <div class="content">
                                        <div class="header">Miembros en la familia</div>
                                        <div class="description">${solicitud.miembros} persona${solicitud.miembros !== 1 ? 's' : ''}</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="calendar icon"></i>
                                    <div class="content">
                                        <div class="header">Fecha de solicitud</div>
                                        <div class="description">${fecha}</div>
                                    </div>
                                </div>
                                ${solicitud.observaciones ? `
                                <div class="item">
                                    <i class="sticky note icon"></i>
                                    <div class="content">
                                        <div class="header">Observaciones</div>
                                        <div class="description">${solicitud.observaciones}</div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="ui divider"></div>
                    
                    <h4 class="ui header">
                        <i class="file icon"></i>
                        Documentos adjuntos
                    </h4>
                    
                    <div class="docs-preview">
                        ${solicitud.documentos.map((doc, index) => `
                            <div class="doc-item">
                                <i class="file pdf icon" style="font-size: 2rem; color: #db2828;"></i>
                                <div style="margin-top: 10px; font-weight: 600;">${doc}</div>
                                <button class="ui basic small button" style="margin-top: 10px;">
                                    <i class="download icon"></i> Descargar
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${solicitud.estado !== 'pending' ? `
                    <div class="timeline">
                        <h4 class="ui header">
                            <i class="history icon"></i>
                            Historial de la solicitud
                        </h4>
                        
                        <div class="timeline-item">
                            <div class="timeline-date">${fecha}</div>
                            <div class="timeline-content">Solicitud enviada por ${solicitud.nombre}</div>
                        </div>
                        
                        ${solicitud.estado === 'approved' ? `
                            <div class="timeline-item">
                                <div class="timeline-date">${new Date(solicitud.fechaAprobacion).toLocaleDateString('es-ES')}</div>
                                <div class="timeline-content">Solicitud aprobada por ${solicitud.aprobadoPor}</div>
                            </div>
                        ` : ''}
                        
                        ${solicitud.estado === 'rejected' ? `
                            <div class="timeline-item">
                                <div class="timeline-date">${new Date(solicitud.fechaRechazo).toLocaleDateString('es-ES')}</div>
                                <div class="timeline-content">
                                    Solicitud rechazada
                                    ${solicitud.motivoRechazo ? `<br><strong>Motivo:</strong> ${solicitud.motivoRechazo}` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    ` : ''}
                `);
                
                // Configurar acciones del modal
                $('#modal-actions').html(`
                    <div class="ui button cancel-modal">
                        Cerrar
                    </div>
                    ${solicitud.estado === 'pending' ? `
                    <div class="ui green button approve-from-modal" data-id="${solicitud.id}">
                        <i class="check icon"></i> Aprobar
                    </div>
                    <div class="ui red button reject-from-modal" data-id="${solicitud.id}">
                        <i class="times icon"></i> Rechazar
                    </div>
                    ` : ''}
                `);
                
                // Eventos de los botones del modal
                $('.cancel-modal').click(function() {
                    $('#detail-modal').modal('hide');
                });
                
                $('.approve-from-modal').click(function() {
                    const id = $(this).data('id');
                    $('#detail-modal').modal('hide');
                    setTimeout(() => confirmAction(id, 'approve'), 300);
                });
                
                $('.reject-from-modal').click(function() {
                    const id = $(this).data('id');
                    $('#detail-modal').modal('hide');
                    setTimeout(() => confirmAction(id, 'reject'), 300);
                });
                
                $('#detail-modal').modal('show');
            }
            
            // Confirmar acción (aprobar/rechazar)
            function confirmAction(id, action) {
                currentSolicitudId = id;
                const solicitud = solicitudes.find(s => s.id === id);
                
                if (action === 'approve') {
                    $('#action-modal-header').text('Confirmar Aprobación');
                    $('#action-message').text(`¿Estás seguro de aprobar la solicitud de ${solicitud.nombre} para el apartamento ${solicitud.apartamento}?`);
                    
                    $('.approve-action').show();
                    $('.reject-action').hide();
                    $('.confirm-action').hide();
                    $('#rejection-form').hide();
                } else {
                    $('#action-modal-header').text('Confirmar Rechazo');
                    $('#action-message').text(`¿Estás seguro de rechazar la solicitud de ${solicitud.nombre}?`);
                    
                    $('.approve-action').hide();
                    $('.reject-action').show();
                    $('.confirm-action').hide();
                    $('#rejection-form').show();
                }
                
                $('#action-modal').modal('show');
            }
            
            // Aprobar solicitud
            $('.approve-action').click(function() {
                const id = currentSolicitudId;
                const index = solicitudes.findIndex(s => s.id === id);
                
                if (index !== -1) {
                    solicitudes[index].estado = 'approved';
                    solicitudes[index].fechaAprobacion = new Date().toISOString().split('T')[0];
                    solicitudes[index].aprobadoPor = 'Gestor Actual';
                    
                    showNotification('Solicitud aprobada exitosamente', 'success');
                    loadSolicitudes();
                    $('#action-modal').modal('hide');
                }
            });
            
            // Rechazar solicitud (mostrar formulario)
            $('.reject-action').click(function() {
                $('#action-message').text('Por favor, especifica el motivo del rechazo:');
                $('.approve-action').hide();
                $('.reject-action').hide();
                $('.confirm-action').show();
            });
            
            // Confirmar rechazo
            $('.confirm-action').click(function() {
                const id = currentSolicitudId;
                const motivo = $('#rejection-reason').val().trim();
                const index = solicitudes.findIndex(s => s.id === id);
                
                if (index !== -1) {
                    solicitudes[index].estado = 'rejected';
                    solicitudes[index].fechaRechazo = new Date().toISOString().split('T')[0];
                    solicitudes[index].motivoRechazo = motivo || 'Sin motivo especificado';
                    
                    $('#rejection-reason').val('');
                    showNotification('Solicitud rechazada exitosamente', 'error');
                    loadSolicitudes();
                    $('#action-modal').modal('hide');
                }
            });
            
            // Cancelar acción
            $('.cancel-action').click(function() {
                $('#action-modal').modal('hide');
                $('#rejection-reason').val('');
            });
            
            // Filtros
            $('.filter-btn').click(function() {
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                currentFilter = $(this).data('filter');
                loadSolicitudes();
            });
            
            // Botón exportar
            $('#export-btn').click(function() {
                // Aquí iría la lógica para exportar
                showNotification('Exportando datos...', 'info');
            });
            
            // Mostrar notificación
            function showNotification(message, type) {
                let icon = 'info circle';
                let color = 'blue';
                
                if (type === 'success') {
                    icon = 'check circle';
                    color = 'green';
                } else if (type === 'error') {
                    icon = 'times circle';
                    color = 'red';
                } else if (type === 'warning') {
                    icon = 'exclamation circle';
                    color = 'yellow';
                }
                
                $('body').toast({
                    class: color,
                    title: type === 'success' ? 'Éxito' : type === 'error' ? 'Error' : 'Información',
                    message: message,
                    showIcon: icon,
                    position: 'top right',
                    displayTime: 4000
                });
            }
            
            // Cargar inicialmente
            loadSolicitudes();
        });
    </script>
</body>
</html>